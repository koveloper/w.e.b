{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/constants.js","webpack:///./src/api.js","webpack:///./src/web-socket-wrapper.js","webpack:///./src/view-elements.js","webpack:///./src/main.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","AppConstants","api","MAGIC","PACKET_FIELD_SIZE_MAGIC","PACKET_FIELD_SIZE_TYPE","PACKET_FIELD_SIZE_DATA_LENGTH","packetTypes","EXIT_BOOTLOADER","READY_FOR_DOWNLOAD_REQUEST","READY_FOR_DOWNLOAD_RESPONSE","FIRMWARE_FRAGMENT_REQUEST","FIRMWARE_FRAGMENT_RESPONSE","PING","FIRMWARE_UPDATE_DONE","WS_ENDPOINT","HTTP_ENDPOINT","location","host","ui","ERROR_SHOW_INTERVAL","Method","SuccessHTTPStatusRange","endpoint","this","_host","_endpoint","_wsIptr","_handleWsOpen","_handleWsMessage","_handleWsCloseOrError","_textMessageReceivedCallback","_binaryDataReceivedCallback","_terminated","textMessageReceivedCallback","binaryDataReceivedCallback","evt","data","_handleWsClosed","open","readyState","WebSocket","CLOSED","binaryType","onopen","onmessage","onclose","onerror","err","setTimeout","close","CLOSING","ArrayBuffer","send","arrayBuf","length","dv","DataView","forEach","byte","setUint8","wsConnectedCallback","updateStatusCallback","super","ping","_ping","_sendWsReadyForDownloadPacket","_handleWsBinaryData","_initialized","_webSocketMode","_autoPingTimerId","_firmwareArrayBuffer","_wsConnectedCallback","_updateStatusCallback","_wsBurnTimer","_wsBurnDone","_wsBurned","setBinaryDataReceivedCallback","byteLength","sendArray","_createWsCommand","packet","offset","firmwareOffset","size","portion","push","getUint8","arrayBuffer","_parseWebSocketInputPacket","type","_handleFirmwareSegmentRequest","minPacketSize","magic","getUint32","dataLength","valueSize","setUint16","setUint32","args","cmd","_insertInDataView","v","url","method","body","headers","Headers","commitProgress","Promise","resolve","reject","xhr","XMLHttpRequest","keys","setRequestHeader","onload","bytesOverall","bytesBurned","percent","finished","upload","onprogress","burnStatus","total","loaded","Math","round","console","log","then","checkStatus","_request","response","toJSON","toBLOB","catch","catchError","status","Error","statusText","json","blob","_blob","isEnabled","intervalMs","clearInterval","setInterval","_makeRequestWithoutDataResponse","firmwareArrayBuffer","_wsBurn","set","ViewElements","error","document","querySelector","errorContent","message","messageContent","appWrapper","webSocketIndicator","exitBootloaderCheckbox","exitBootloaderYesButton","exitBootloaderCancelButton","chooseFirmwareButton","chosenFilenameSpan","chooseFirmwareDialogButton","burnButton","burnStatusSpan","burnStatusProgressBar","_firmwareArrayBuf","wrapModalMessage","modalElement","_modalElement","_timerId","show","text","textContent","style","maxHeight","opacity","clearTimeout","errorModal","messageModal","isConnected","width","classList","remove","addEventListener","checked","exitBootloader","disabled","click","e","file","target","files","reader","FileReader","readAsArrayBuffer","readerEvent","result","isBurning","burn","init","setAutopingMode"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export const AppConstants = {\r\n  api: {\r\n    MAGIC: 0xFF0110FF,\r\n    PACKET_FIELD_SIZE_MAGIC: 4,\r\n    PACKET_FIELD_SIZE_TYPE: 2,\r\n    PACKET_FIELD_SIZE_DATA_LENGTH: 4,\r\n    packetTypes: {\r\n      EXIT_BOOTLOADER: 0x0001,\r\n      READY_FOR_DOWNLOAD_REQUEST: 0x0002,\r\n      READY_FOR_DOWNLOAD_RESPONSE: 0x0003,\r\n      FIRMWARE_FRAGMENT_REQUEST: 0x0004,\r\n      FIRMWARE_FRAGMENT_RESPONSE: 0x0005,\r\n      PING: 0x0006,\r\n      FIRMWARE_UPDATE_DONE: 0x0007,\r\n    },\r\n    WS_ENDPOINT: 'bootloader/ws',\r\n    HTTP_ENDPOINT: `http://${location.host}/bootloader`\r\n  },\r\n  ui: {\r\n    ERROR_SHOW_INTERVAL: 5000\r\n  }\r\n};","import { AppConstants } from './constants';\r\nimport WebSocketWrapper from './web-socket-wrapper';\r\n\r\n\r\nconst Method = {\r\n  GET: 'GET',\r\n  PUT: 'PUT',\r\n  POST: 'POST',\r\n  DELETE: 'DELETE',\r\n};\r\n\r\nconst SuccessHTTPStatusRange = {\r\n  MIN: 200,\r\n  MAX: 299,\r\n};\r\n\r\nexport class Api extends WebSocketWrapper {\r\n  constructor({ wsConnectedCallback, updateStatusCallback } = {}) {\r\n    super({ endpoint: AppConstants.api.WS_ENDPOINT });\r\n    this._endpoint = AppConstants.api.HTTP_ENDPOINT;\r\n    this.ping = this.ping.bind(this);\r\n    this._ping = this._ping.bind(this);\r\n    this._sendWsReadyForDownloadPacket = this._sendWsReadyForDownloadPacket.bind(this);\r\n    this._handleWsBinaryData = this._handleWsBinaryData.bind(this);\r\n    this._initialized = false;\r\n    this._webSocketMode = false;\r\n    this._autoPingTimerId = null;\r\n    this._firmwareArrayBuffer = null;\r\n    this._wsConnectedCallback = wsConnectedCallback;\r\n    this._updateStatusCallback = updateStatusCallback;\r\n    this._wsBurnTimer = null;\r\n    this._wsBurnDone = false;\r\n    this._wsBurned = 0;\r\n  }\r\n\r\n  init() {\r\n    if(this._initialized) {\r\n      return;\r\n    }\r\n    this._initialized = true;\r\n    this.setBinaryDataReceivedCallback(this._handleWsBinaryData);\r\n    this.open();\r\n  }\r\n\r\n  _handleWsOpen() {\r\n    this._webSocketMode = true;\r\n    if(this._wsConnectedCallback) {\r\n      this._wsConnectedCallback(true);\r\n    }\r\n  }\r\n\r\n  _handleWsClosed() {\r\n    this._webSocketMode = false;\r\n    if(this._wsConnectedCallback) {\r\n      this._wsConnectedCallback(false);\r\n    }\r\n  }\r\n\r\n  _sendWsReadyForDownloadPacket() {\r\n    const data = this._firmwareArrayBuffer === null ?\r\n      [0, 0, 0, 0]\r\n      : [\r\n        this._firmwareArrayBuffer.byteLength & 255,\r\n        (this._firmwareArrayBuffer.byteLength >> 8) & 255,\r\n        (this._firmwareArrayBuffer.byteLength >> 16) & 255,\r\n        (this._firmwareArrayBuffer.byteLength >> 24) & 255,\r\n      ];\r\n    return this.sendArray(\r\n        this._createWsCommand(\r\n            AppConstants.api.packetTypes.READY_FOR_DOWNLOAD_RESPONSE,\r\n            data\r\n        )\r\n    );\r\n  }\r\n\r\n  _handleFirmwareSegmentRequest(packet) {\r\n    if(this._firmwareArrayBuffer === null) {\r\n      this._sendWsReadyForDownloadPacket();\r\n    }\r\n    if(packet.data.length < 6) {\r\n      return;\r\n    }\r\n    let offset = 0;\r\n    let firmwareOffset = packet.data[offset++]\r\n      | (packet.data[offset++] << 8)\r\n      | (packet.data[offset++] << 16)\r\n      | (packet.data[offset++] << 24);\r\n    let size = packet.data[offset++]\r\n      | (packet.data[offset++] << 8);\r\n    if(firmwareOffset < this._firmwareArrayBuffer) {\r\n      const portion = [];\r\n      while(firmwareOffset < this._firmwareArrayBuffer.byteLength && size--) {\r\n        portion.push(this._firmwareArrayBuffer.getUint8(firmwareOffset++));\r\n      }\r\n      this.sendArray(\r\n          this._createWsCommand(\r\n              AppConstants.api.packetTypes.FIRMWARE_FRAGMENT_RESPONSE,\r\n              portion\r\n          )\r\n      );\r\n      this._wsBurned = firmwareOffset;\r\n    }\r\n  }\r\n\r\n  _handleWsBinaryData(arrayBuffer) {\r\n    this._webSocketMode = true;    \r\n    const packet = this._parseWebSocketInputPacket(arrayBuffer);\r\n    if(!packet) {\r\n      return;\r\n    }\r\n    switch(packet.type) {\r\n      case AppConstants.api.packetTypes.PING:\r\n        this.ping();\r\n        break;\r\n      case AppConstants.api.packetTypes.READY_FOR_DOWNLOAD_REQUEST:\r\n        this._sendWsReadyForDownloadPacket();\r\n        break;\r\n      case AppConstants.api.packetTypes.FIRMWARE_FRAGMENT_REQUEST:\r\n        this._handleFirmwareSegmentRequest(packet);\r\n        break;\r\n      case AppConstants.api.packetTypes.FIRMWARE_UPDATE_DONE:\r\n        this._wsBurnDone = true;\r\n        break;\r\n    }\r\n  }\r\n\r\n  _parseWebSocketInputPacket(arrayBuffer) {\r\n    const dv = new DataView(arrayBuffer);\r\n    const minPacketSize = AppConstants.api.PACKET_FIELD_SIZE_MAGIC + AppConstants.api.PACKET_FIELD_SIZE_TYPE + AppConstants.api.PACKET_FIELD_SIZE_DATA_LENGTH;\r\n    if(arrayBuffer.byteLength < minPacketSize) {\r\n      return null;\r\n    }  \r\n    const packet = {\r\n      magic: dv.getUint32(0, true),\r\n      type: dv.getUint32(AppConstants.api.PACKET_FIELD_SIZE_MAGIC, true),\r\n      dataLength: dv.getUint32(AppConstants.api.PACKET_FIELD_SIZE_MAGIC + AppConstants.api.PACKET_FIELD_SIZE_TYPE, true),\r\n    };\r\n    if(packet.magic !== AppConstants.api.MAGIC) {\r\n      return null;\r\n    }\r\n    if(packet.dataLength !== (arrayBuffer.byteLength - minPacketSize)) {\r\n      return null;\r\n    }\r\n    packet.data = [];\r\n    for(let offset = 0; offset < packet.dataLength; offset++) {\r\n      packet.data.push(dv.getUint8(minPacketSize + offset));\r\n    }\r\n    return packet;\r\n  }\r\n\r\n  _insertInDataView(dv, offset, value, valueSize) {\r\n    switch(valueSize) {\r\n      case 1: dv.setUint8(offset, value);\r\n        break;\r\n      case 2: dv.setUint16(offset, value, true);\r\n        break;\r\n      case 4: dv.setUint32(offset, value, true);\r\n        break;\r\n      default:\r\n        return offset;\r\n    }\r\n    return offset + valueSize;\r\n  }\r\n\r\n  _createWsCommand(type, ...args) {\r\n    const cmd = new ArrayBuffer(\r\n        AppConstants.api.PACKET_FIELD_SIZE_MAGIC\r\n        + AppConstants.api.PACKET_FIELD_SIZE_TYPE\r\n        + AppConstants.api.PACKET_FIELD_SIZE_DATA_LENGTH\r\n        + args.length\r\n    );\r\n    const dv = new DataView(cmd);\r\n    let offset = this._insertInDataView(dv, 0, AppConstants.api.MAGIC, AppConstants.api.PACKET_FIELD_SIZE_MAGIC);\r\n    offset = this._insertInDataView(dv, offset, type, AppConstants.api.PACKET_FIELD_SIZE_TYPE);\r\n    offset = this._insertInDataView(dv, offset, args ? args.length : 0, AppConstants.api.PACKET_FIELD_SIZE_DATA_LENGTH);\r\n    args.forEach(v => dv.setUint8(offset++, v));\r\n    return cmd;\r\n  }\r\n\r\n  _request({\r\n    url,\r\n    method = Method.GET,\r\n    body = null,\r\n    headers = new Headers(),\r\n    commitProgress = false\r\n  }) {\r\n    return new Promise((resolve, reject) => {\r\n      let xhr = new XMLHttpRequest();\r\n      xhr.open(method, `${this._endpoint}/${url}`);\r\n      headers.keys.forEach((key) => {\r\n        xhr.setRequestHeader(key, headers.get(key));\r\n      });\r\n      xhr.send(body);\r\n      xhr.onload = () => {\r\n        if(commitProgress && this._updateStatusCallback) {\r\n          this._updateStatusCallback({\r\n            bytesOverall: this._firmwareArrayBuffer.byteLength,\r\n            bytesBurned: this._firmwareArrayBuffer.byteLength,\r\n            percent: 100,\r\n            finished: true\r\n          });\r\n        }\r\n        resolve(xhr);\r\n      };\r\n      xhr.onerror = () => {\r\n        reject('Error while performing XMLHttpRequest');\r\n      };\r\n      if(commitProgress && this._updateStatusCallback) {\r\n        xhr.upload.onprogress = function(evt) {\r\n          const burnStatus = {\r\n            bytesOverall: evt.total,\r\n            bytesBurned: evt.loaded,\r\n            percent: Math.round(evt.loaded * 100 / evt.total),\r\n            finished: false\r\n          };\r\n          console.log(burnStatus);\r\n          this._updateStatusCallback(burnStatus);\r\n        };\r\n      }\r\n    }).then(Api.checkStatus);\r\n  }\r\n\r\n  _makeRequestWithDataResponse({\r\n    url,\r\n    method = Method.GET,\r\n    body = null,\r\n    headers = new Headers(),\r\n  }) {\r\n    return this._request({ url, method, body, headers })\r\n      .then((response) => {\r\n        return response.headers.get('Content-Type') === 'application/json' ? Api.toJSON(response) : Api.toBLOB(response);\r\n      })\r\n      .catch(Api.catchError);\r\n  }\r\n\r\n  _makeRequestWithoutDataResponse({\r\n    url,\r\n    method = Method.GET,\r\n    body = null,\r\n    headers = new Headers(),\r\n    commitProgress = false\r\n  }) {\r\n    return this._request({ url, method, body, headers, commitProgress })\r\n      .catch(Api.catchError);\r\n  }\r\n\r\n  static checkStatus(xhr) {\r\n    if (\r\n      xhr.status < SuccessHTTPStatusRange.MIN ||\r\n      xhr.status > SuccessHTTPStatusRange.MAX\r\n    ) {\r\n      throw new Error(`${xhr.status}: ${xhr.statusText}`);\r\n    }\r\n    return xhr.response;\r\n  }\r\n\r\n  static toJSON(response) {\r\n    return response.json();\r\n  }\r\n\r\n  static toBLOB(response) {\r\n    return response.blob().then(_blob => {\r\n      return _blob;\r\n    });\r\n  }\r\n  \r\n  static catchError(err) {\r\n    throw err;\r\n  }\r\n\r\n  setAutopingMode(isEnabled, intervalMs = 1000) {\r\n    if(this._autoPingTimerId !== null) {\r\n      clearInterval(this._autoPingTimerId);\r\n    }\r\n    if(!isEnabled) {\r\n      return;\r\n    }\r\n    this._autoPingTimerId = setInterval(this._ping, intervalMs < 1000 ? 1000 : intervalMs);\r\n  }\r\n\r\n  _ping() {\r\n    this.ping().then(() => {}).catch(() => {});\r\n  }\r\n  \r\n  ping() {\r\n    if(this._firmwareArrayBuffer) {\r\n      return Promise.reject();\r\n    }\r\n    if(this._webSocketMode) {\r\n      return new Promise((resolve, reject) => {\r\n        if(this.sendArray(this._createWsCommand(AppConstants.api.packetTypes.PING))) {\r\n          resolve();\r\n        }\r\n        reject('web socket transmit error');    \r\n      });\r\n    }    \r\n    return this._makeRequestWithoutDataResponse({\r\n      url: 'ping',\r\n      method: Method.GET,      \r\n    }).then((response) => {\r\n      this.close();\r\n      return Promise.resolve(response);\r\n    });\r\n  }  \r\n\r\n  exitBootloader() {\r\n    if(this._webSocketMode) {\r\n      return new Promise((resolve, reject) => {\r\n      \r\n        if(this.sendArray(this._createWsCommand(AppConstants.api.packetTypes.EXIT_BOOTLOADER))) {\r\n          resolve();\r\n        }\r\n        reject('web socket transmit error');\r\n      });\r\n    }\r\n    return this._makeRequestWithoutDataResponse({\r\n      url: 'exit',\r\n      method: Method.GET,      \r\n    });\r\n  }\r\n\r\n  _wsBurn() {\r\n    return new Promise((resolve, reject) => {\r\n      this._wsBurnTimer = setInterval(() => {\r\n        if(this._wsBurnDone) {\r\n          this._updateStatusCallback({\r\n            bytesOverall: this._firmwareArrayBuffer.byteLength,\r\n            bytesBurned: this._firmwareArrayBuffer.byteLength,\r\n            percent: 100,\r\n            finished: true\r\n          });\r\n          clearInterval(this._wsBurnTimer);\r\n          resolve();\r\n        } else {\r\n          if(this._updateStatusCallback) {\r\n            const burnStatus = {\r\n              bytesOverall: this._firmwareArrayBuffer.byteLength,\r\n              bytesBurned: this._wsBurned,\r\n              percent: Math.round(this._wsBurned * 100 / this._firmwareArrayBuffer.byteLength),\r\n              finished: false\r\n            };\r\n            console.log(burnStatus);\r\n            this._updateStatusCallback(burnStatus);\r\n          }\r\n        }\r\n        console.log('ws burn cycle operation');\r\n        if(!this._sendWsReadyForDownloadPacket()) {\r\n          reject();          \r\n        }\r\n      }, 100);\r\n    });\r\n  }\r\n\r\n  isBurning() {\r\n    return this._firmwareArrayBuffer !== null;\r\n  }\r\n\r\n  burn(firmwareArrayBuffer) {\r\n    console.log('burn');\r\n    console.log(firmwareArrayBuffer);\r\n    if(!firmwareArrayBuffer || this._firmwareArrayBuffer) {\r\n      return Promise.reject('burning already started');\r\n    }\r\n    this._firmwareArrayBuffer = firmwareArrayBuffer;\r\n    if(this._webSocketMode) {\r\n      return this._wsBurn();\r\n    }\r\n    const headers = new Headers();\r\n    headers.set('Content-Type', 'application/octet-stream');\r\n    return this._makeRequestWithoutDataResponse({\r\n      url: 'burn',\r\n      method: Method.POST,\r\n      headers,\r\n      body: firmwareArrayBuffer,\r\n      commitProgress: true\r\n    }).catch(err => {\r\n      this._firmwareArrayBuffer = null;\r\n      throw err;\r\n    });\r\n  }\r\n}","export default class WebSocketWrapper {\r\n\r\n  constructor({ host = location.host, endpoint}) {\r\n    this._host = host;\r\n    this._endpoint = endpoint;\r\n    this._wsIptr = null;\r\n    this._handleWsOpen = this._handleWsOpen.bind(this);\r\n    this._handleWsMessage = this._handleWsMessage.bind(this);\r\n    this._handleWsCloseOrError = this._handleWsCloseOrError.bind(this);\r\n    this._textMessageReceivedCallback = null;\r\n    this._binaryDataReceivedCallback = null;\r\n    this._terminated = false;\r\n  }\r\n\r\n  setTextMessageReceivedCallback(textMessageReceivedCallback) {\r\n    this._textMessageReceivedCallback = textMessageReceivedCallback;\r\n  }\r\n\r\n  setBinaryDataReceivedCallback(binaryDataReceivedCallback) {\r\n    this._binaryDataReceivedCallback = binaryDataReceivedCallback;\r\n  }\r\n\r\n  _handleWsOpen() {\r\n  }\r\n\r\n  _handleWsClosed() {\r\n  }\r\n\r\n  _handleWsMessage(evt) {\r\n    if (typeof (evt.data) === 'string') {\r\n      if(this._textMessageReceivedCallback) {\r\n        this._textMessageReceivedCallback(evt.data);\r\n      }\r\n      return;\r\n    }\r\n    if(this._binaryDataReceivedCallback) {\r\n      this._binaryDataReceivedCallback(evt.data);\r\n    }    \r\n  }\r\n\r\n  _handleWsCloseOrError() {\r\n    this._handleWsClosed();\r\n    this.open();\r\n  }\r\n\r\n  open() {\r\n    if (this._wsIptr && this._wsIptr.readyState !== WebSocket.CLOSED) {\r\n      return;\r\n    }\r\n    if(this._terminated) {\r\n      return;\r\n    }\r\n    try {\r\n      this._wsIptr = new WebSocket(`ws://${this._host}${this._endpoint}`);\r\n      this._wsIptr.binaryType = 'arraybuffer';\r\n      this._wsIptr.onopen = this._handleWsOpen;\r\n      this._wsIptr.onmessage = this._handleWsMessage;\r\n      this._wsIptr.onclose = this._handleWsCloseOrError;\r\n      this._wsIptr.onerror = this._handleWsCloseOrError;\r\n    } catch(err) {\r\n      setTimeout(this._handleWsCloseOrError, 1000);\r\n    }    \r\n  }\r\n\r\n  close() {\r\n    if (!this._wsIptr) {\r\n      return;\r\n    }\r\n    this._wsIptr.onopen = null;\r\n    this._wsIptr.onmessage = null;\r\n    this._wsIptr.onerror = null;\r\n    this._wsIptr.onclose = null;\r\n    this._wsIptr.close();\r\n    this._wsIptr = null;\r\n    this._terminated = true;\r\n  }\r\n\r\n  sendArray(data = []) {\r\n    if (!this._wsIptr) {\r\n      this.open();\r\n      return false;\r\n    }\r\n    if (this._wsIptr.readyState === WebSocket.CLOSING) {\r\n      this._handleWsCloseOrError();      \r\n      return false;\r\n    }\r\n    if (this._wsIptr.readyState === WebSocket.CLOSED) {\r\n      this.open();\r\n      this._handleWsCloseOrError();      \r\n      return false;\r\n    }\r\n    if(data instanceof ArrayBuffer) {\r\n      this._wsIptr.send(data);\r\n      return true;\r\n    }\r\n    const arrayBuf = new ArrayBuffer(data.length);\r\n    const dv = new DataView(arrayBuf);\r\n    data.forEach((byte, i) => { dv.setUint8(i, byte); });\r\n    try {\r\n      this._wsIptr.send(arrayBuf);\r\n      return true;\r\n    } catch(err) {\r\n      this._handleWsCloseOrError();\r\n    }    \r\n    return false;\r\n  }  \r\n}","export const ViewElements = {\r\n  error: document.querySelector('.error'),\r\n  errorContent: document.querySelector('.error-content'),\r\n  message: document.querySelector('.message'),\r\n  messageContent: document.querySelector('.message-content'),\r\n  appWrapper: document.querySelector('.app-wrapper'),\r\n  webSocketIndicator: document.querySelector('.header-web-socket-inidicator'),\r\n  exitBootloaderCheckbox: document.querySelector('#exit-boot'),\r\n  exitBootloaderYesButton: document.querySelector('#exit-boot-yes'),\r\n  exitBootloaderCancelButton: document.querySelector('#exit-boot-cancel'),\r\n  chooseFirmwareButton: document.querySelector('#choose-firmware'),\r\n  chosenFilenameSpan: document.querySelector('.main-choose-firmware-chosen-file'),\r\n  chooseFirmwareDialogButton: document.querySelector('#file-input'),\r\n  burnButton: document.querySelector('#burn'),\r\n  burnStatusSpan: document.querySelector('.main-burn-status'),\r\n  burnStatusProgressBar: document.querySelector('.main-burn-progress-bar'),\r\n};","import { Api } from './api';\r\nimport { AppConstants } from './constants';\r\nimport { ViewElements } from './view-elements';\r\n\r\nlet _firmwareArrayBuf = null;\r\n\r\nconst wrapModalMessage = function(modalElement) {\r\n  const _modalElement = modalElement;\r\n  let _timerId = null;\r\n  return {\r\n    show: (text) => {\r\n      _modalElement.querySelector('div').textContent = text;\r\n      _modalElement.style.maxHeight = '100px';\r\n      _modalElement.style.opacity = 1;\r\n      if(_timerId) {\r\n        clearTimeout(_timerId);\r\n        _timerId = null;\r\n      }\r\n      _timerId = setTimeout(() => {\r\n        clearTimeout(_timerId);\r\n        _modalElement.style.maxHeight = 0;\r\n        _modalElement.style.opacity = 0;\r\n        _timerId = null;\r\n      }, AppConstants.ui.ERROR_SHOW_INTERVAL);    \r\n    }\r\n  };\r\n};\r\n\r\nconst errorModal = new wrapModalMessage(ViewElements.error);\r\nconst messageModal = new wrapModalMessage(ViewElements.message);\r\n\r\nconst api = new Api({\r\n  wsConnectedCallback: (isConnected) => {\r\n    ViewElements.webSocketIndicator.style.opacity = isConnected ? '0.7' : '0';\r\n  },\r\n  updateStatusCallback: (status) => {\r\n    ViewElements.burnStatusSpan.textContent = `${status.percent}%`;\r\n    ViewElements.burnStatusProgressBar.style.width = `${status.percent}%`;\r\n    if(status.finished) {\r\n      ViewElements.burnStatusSpan.textContent = '';\r\n      ViewElements.burnStatusProgressBar.style.width = '0';      \r\n    }    \r\n  }\r\n});\r\n\r\nconst initView = () => {\r\n  ViewElements.appWrapper.classList.remove('vertical-hided');\r\n  ViewElements.exitBootloaderCancelButton.addEventListener('click', () => {\r\n    ViewElements.exitBootloaderCheckbox.checked = false;\r\n  });\r\n  ViewElements.exitBootloaderYesButton.addEventListener('click', () => {\r\n    api.exitBootloader()\r\n      .then(() => {\r\n\r\n      })\r\n      .catch((err) => {\r\n        errorModal.show(err);\r\n      });\r\n  });\r\n  ViewElements.chooseFirmwareButton.addEventListener('click', () => {\r\n    _firmwareArrayBuf = null;\r\n    ViewElements.burnButton.disabled = true;\r\n    ViewElements.chosenFilenameSpan.textContent = '';\r\n    ViewElements.chooseFirmwareDialogButton.click();\r\n  });\r\n  ViewElements.chooseFirmwareDialogButton.addEventListener('change', (e) => {\r\n    const file = e.target.files[0]; \r\n    ViewElements.chosenFilenameSpan.textContent = file.name;\r\n    // setting up the reader\r\n    const reader = new FileReader();\r\n    reader.readAsArrayBuffer(file);\r\n    // here we tell the reader what to do when it's done reading...\r\n    reader.onload = readerEvent => {\r\n      _firmwareArrayBuf = readerEvent.target.result;\r\n      ViewElements.burnButton.disabled = false;\r\n    };\r\n  });\r\n  ViewElements.burnButton.addEventListener('click', () => {\r\n    if(ViewElements.burnButton.disabled || api.isBurning()) {\r\n      return;\r\n    }\r\n    api.burn(_firmwareArrayBuf)\r\n    .then(() => {\r\n      messageModal.show('BURN DONE!');\r\n    })\r\n    .catch((err) => {\r\n      errorModal.show(err);\r\n    });\r\n  });\r\n};\r\n\r\ninitView();\r\n\r\napi.init();\r\napi.setAutopingMode(true, 5000);"],"sourceRoot":""}